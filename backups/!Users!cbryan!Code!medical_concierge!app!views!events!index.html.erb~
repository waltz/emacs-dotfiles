<%= stylesheet_link_tag "tabs" %>
<%= javascript_include_tag 'data' %>
  <script src="javascripts/popup.js" type="text/javascript"></script>
  <link rel="stylesheet" href="stylesheets/popup.css" type="text/css" /> 

<script>

  function saveEventDate(task_id, token){
     val = 'task_starts_at_' + task_id
     pop = 'popup_link_'+ task_id
     panel = 'date_panel_' + task_id
     var thedate = document.getElementById(val).value
      
    new Ajax.Updater(panel, '/events/change_date', {
      method: 'post',
      parameters: {authenticity_token: token, task_id:task_id, newdate:thedate },
      onSuccess: function(transport){
        var response = transport.responseText || "no response text";
      },
      onComplete: function(){
        $(pop).popup.hide();
      },
      onFailure: function(){ alert('Something went wrong...') }
      });
  }


  function getReport(){
    url = getReportURL()
    document.getElementById('report_frame').src = url
  }

  function get_radio_value()
  {
    var rad_val = ""
    for (var i=0; i < document.form1.events.length; i++)
       {
       if (document.form1.events[i].checked)
          {
          rad_val = document.form1.events[i].value;
          }
       }
   return rad_val
  }

  function getReportURL(){
    notes = document.getElementById('notes').checked
    period = get_radio_value()
    var randomnumber=Math.floor(Math.random()*11)
    url = "<%= report_url(:id => session['client'].id) %>" + "?notes=" + notes + "&period=" + period + "&start_date=<%=@start_date%>" + "&rand=" + randomnumber
    return url
  }

  function setReportURL(){
    document.getElementById('report_frame').src = getReportURL();
  }

  function emailReport(){

    notes = document.getElementById('notes').checked
    message = document.getElementById('message').value
    to = document.getElementById('email_to').value
    period = get_radio_value()
    url = "<%= url_for :controller => 'client_pdf', :action => 'pdf_email' %>"

    new Ajax.Updater('report_frame', url, {
      method: 'get',
      parameters: {authenticity_token: '<%= form_authenticity_token %>', id: <%=  session['client'].id %>, notes: notes, period: period, start_date:'<%=@start_date.strftime('%m/%d/%Y')%>', message: message, email_to: to },
      onSuccess: function(transport){
        var response = transport.responseText || "no response text";
      },
      onComplete: function(){

      },
      onFailure: function(){ alert('Something went wrong...') }
      });

  }


</script>


 <div class="content" id="panel_1">
   <%= render :partial => @subform.to_s %>
</div>

