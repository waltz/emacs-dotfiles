var ImageAttachmentDialog = 
{
  new_id : new String,

  // This function gets called when the TinyMCE popup lib is done being called.
  // It messes with the DOM a bunch, so finding elements is unreliable if done
  // outside this function.
  init : function()
  {
    // var assoc = "image_attachments";
    // var content = window.parent.$('#' + assoc + '_fields_template').html();
    // var regexp  = new RegExp('new_' + assoc, 'g');
    // this.new_id  = new Date().getTime();
    // $("#form_container").html(content.replace(regexp, this.new_id));
    $("#new_image_submit").click(this.insert);
  },

  insert : function()
  {
    // Copy the form to the parent.
    // var id_prefix = "post_image_attachments_attributes_" + ImageAttachmentDialog.new_id + '_';

    // window.parent.importImageAttachment();

    // var form_wrapper = '<div id="' + id_prefix + '">' + $("#form_container").html() + '</div>';
    // window.parent.$("#image_attachments").prepend($("#form_container")[0].importNode(true));
    // console.log($("#form_container")[0].importNode(true));

    // var oldNode = document.getElementById("form_container");
    // var freshNode = window.parent.importNode(oldNode, true);
    // window.parent.getElementById("image_attachments").appendChild(freshNode);
    
    // Copy form values to the parent.
    // var field_names = [ "author_name", "title", "url", "image_attachment" ];
    // for(var i = 0; i < field_names.length; i++) {
    //   var field_name = '#' + id_prefix + field_names[i];
    //   window.parent.$(field_name)[0].value = $(field_name)[0].value;
    // }

    // Read the image file input and show a preview.
    // var image_input = window.parent.$('#' + id_prefix + this.new_id + '_image_attachment');
    // console.log(image_input);
    // var image = image_input[0].files[0];

    // var fr = new FileReader();
    
    // fr.onload(function(event) {
    //   this.render_preview(event.target.result);
    // });
    
    // fr.readAsDataURL(image);

    tinyMCEPopup.close();
    return false;
  }//,

  // render_preview : function(image_data) {
  //   var editor = tinyMCEPopup.editor;
  //   var preview = '<br/><img height="50px" width="50px"src="' + image_data + '"</img><br/>';
  //   editor.execCommand('mceInsertRawHTML', false, preview);
  // }
};
tinyMCEPopup.onInit.add(ImageAttachmentDialog.init, ImageAttachmentDialog);
